@{

    ViewBag.Title = Resources.Resource.create;
}


<div class="page-content-wrapper">
    <div class="page-content">
        <div class="page-bar">
            <ul class="page-breadcrumb">
                <li>
                    <span>Sql Studio</span>
                </li>
            </ul>
            <div class="page-toolbar"></div>
        </div>
        <div class="row">
            <div class="col-xs-12">
                <div class="portlet light bordered">
                    <div class="portlet-title tabbable-line">
                        <div class="caption">
                            <i class="icon-share font-dark"></i>
                            <span class="caption-subject font-dark bold uppercase">Sql Studio</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <div class="tab-content">
                            <div class="form-horizontal">

                                <div class="col-sm-12" style="margin:2px 0px;">
                                    <div class="alert alert-warning">Não é aplicado nenhum filtro no que é escrito. Tenha muita responsabilidade ao utilizar.</div>
                                </div>

                                <div class="col-sm-12" style="margin:2px 0px;">
                                    <strong>Digite abaixo a query para ser executada.*</strong>
                                </div>

                                <div class="col-sm-12" style="margin:2px 0px;">
                                    <textarea class="col-md-12" name="query" rows="5"></textarea>
                                </div>

                                <div class="col-sm-12" style="margin:2px 0px;">
                                    <button type="submit" class="btn btn-primary">
                                        @Resources.Resource.send
                                    </button>
                                </div>
                            </div>

                            <div class="col-sm-12" style="margin:2px 0px;">
                                <table id="resultsApontamentos" class="table table-striped"></table>
                            </div>

                            <div class="clearfix"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $("#IsActive").prop('checked', true);

    var initDatatable = function () {
        setTimeout(function (e) {
            var oTable = $('#resultsApontamentos').dataTable();
            if (oTable.length > 0) {
                oTable.fnAdjustColumnSizing();
            }
        }, 100);
    }
    $('button[type="submit"]').on('click', function () {
        $.ajax({
            type: "POST",
            url: "@Html.Raw(Url.Action("RunSqlStudio", "api/UtilidadesAPI"))",
            dataType: "json",
            data: '"' + $('textarea[name="query"]').val() + '"',
            contentType: "application/json",
            success: function (retorno) {
                if (typeof (retorno) == 'string') {
                    alert(retorno);
                    return;
                }
                var table = datatableGRT.Inicializar({
                    idTabela: "resultsApontamentos",
                    listaDeDados: retorno.datas,
                    colunaDosDados: retorno.columns,
                    numeroLinhasNaTabela: 25,
                    aplicarResponsividade: true,
                    tamanhosDoMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, "-"]],
                    loadingRecords: true,
                    destroy: true,
                    info: true,
                    initComplete: initDatatable,
                    createdRow: function (row, data, index) {
                    }
                });
            },
            always: function (data) {
            }
        });
    });

</script>
