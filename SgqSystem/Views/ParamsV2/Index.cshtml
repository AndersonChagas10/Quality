<style>
    .tab-pane {
        display: none;
    }

        .tab-pane.active {
            display: block;
        }

    .nav-b-0 {
        margin-bottom: 0px;
    }

    .tab-content.border {
        border-left: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        border-right: 1px solid #ddd;
        border-top: 0px;
        padding-bottom: 100px;
    }

        .tab-content.border a {
            font-size: 20px;
            padding: 15px;
        }

    .tab-content h4 {
        display: block;
        background: #eee;
        text-align: center;
        margin: 0px;
        padding-top: 20px;
        padding-bottom: 20px;
    }
</style>

<style>
    .switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
    }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        -webkit-transition: .4s;
        transition: .4s;
    }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

    input:checked + .slider {
        background-color: #2196F3;
    }

    input:focus + .slider {
        box-shadow: 0 0 1px #2196F3;
    }

    input:checked + .slider:before {
        -webkit-transform: translateX(26px);
        -ms-transform: translateX(26px);
        transform: translateX(26px);
    }

    /* Rounded sliders */
    .slider.round {
        border-radius: 34px;
    }

        .slider.round:before {
            border-radius: 50%;
        }

    .select2 {
        width: 100% !important;
    }
</style>


<div class="page-content-wrapper">
    <div class="page-content">
        <h1 class="page-title">
            @Resources.Resource.customization
        </h1>

        <div class="page-bar">
            <ul class="page-breadcrumb">
                <li>
                    <a href="#">Home</a>
                    <i class="fa fa-angle-right"></i>
                </li>
                <li>
                    <span>@Resources.Resource.customization</span>
                </li>
            </ul>
        </div>

        @Html.Partial("~/Views/Shared/_MensagemAtualizartablets.cshtml")

        <div class="row">
            <div class="col-sm-12">
                <ul class="nav nav-tabs nav-b-0">
                    <li class="active col-sm-3">
                        <a data-toggle="tab" href="#l1">
                            Indicador (Level 1)
                            <select id="selectL1" class="input input-lg col-sm-12"></select>
                        </a>
                    </li>
                    <li class="col-sm-3">
                        <a data-toggle="tab" href="#l2">
                            Monitoramento (Level 2)
                            <select id="selectL2" class="input input-lg"></select>
                        </a>
                    </li>
                    <li class="col-sm-3">
                        <a data-toggle="tab" href="#l3">
                            Tarefa (Level 3)
                            <select id="selectL3" class="input input-lg"></select>
                        </a>
                    </li>
                </ul>

                <div class="tab-content border">
                    <div class="col-sm-12">
                        <div id="l1" class="tab-pane fade in active">
                            <h3 class="jumbotron text-center" data-name="Name"></h3>
                            <div class="col-xs-3">
                                <ul class="nav nav-tabs tabs-left">
                                    <li class="active">
                                        <a href="#l1_geral" data-toggle="tab">
                                            Informações gerais
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#l1_avancados" data-toggle="tab">
                                            Itens avançados
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#l1_campocabecalho" data-toggle="tab">
                                            Campos de cabeçalhos
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#l1_processo" data-toggle="tab">
                                            Processos
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="col-xs-9">
                                <div class="tab-content">                                   
                                    <div class="tab-pane active" id="l1_geral">
                                        @Html.Partial("ParL1Geral")
                                    </div>
                                    <div class="tab-pane" id="l1_avancados">
                                        @Html.Partial("ParL1Avancados")
                                    </div>
                                    <div class="tab-pane" id="l1_campocabecalho">
                                        @Html.Partial("ParL1Cabecalho")
                                    </div>
                                    <div class="tab-pane" id="l1_processo">
                                        @Html.Partial("ParL1Processo")
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="l2" class="tab-pane fade">
                            <h3 class="jumbotron text-center" data-name="Name"></h3>
                            <div class="col-xs-3">
                                <ul class="nav nav-tabs tabs-left">
                                    <li class="active">
                                        <a href="#l2_geral" data-toggle="tab">
                                            Informações gerais
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#l2_avancados" data-toggle="tab">
                                            Itens avançados
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#l2_avam" data-toggle="tab">
                                            Avaliação e Amostra
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#l2_cabecalho" data-toggle="tab">
                                            Cabeçalhos no monitoramento
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#l2_contador" data-toggle="tab">
                                            Contadores
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="col-xs-9">
                                <div class="tab-content">
                                    <div class="tab-pane active" id="l2_geral">
                                        @Html.Partial("ParL2Geral")
                                    </div>
                                    <div class="tab-pane" id="l2_avancados">
                                        @Html.Partial("ParL2Avancados")
                                    </div>
                                    <div class="tab-pane" id="l2_avam">
                                        @Html.Partial("ParL2Avam")
                                    </div>
                                    <div class="tab-pane" id="l2_cabecalho">
                                        @Html.Partial("ParL2Cabecalho")
                                    </div>
                                    <div class="tab-pane" id="l2_contador">
                                        @Html.Partial("ParL2Contador")
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="l3" class="tab-pane fade">
                            <h3 class="jumbotron text-center" data-name="Name"></h3>
                            <div class="col-xs-3">
                                <ul class="nav nav-tabs tabs-left">
                                    <li class="active">
                                        <a href="#l3_geral" data-toggle="tab">
                                            Informações gerais
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#l3_avancados" data-toggle="tab">
                                            Itens avançados
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#l3_avam" data-toggle="tab">
                                            Avaliação e Amostra
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#l3_tipo_dado_entrada" data-toggle="tab">
                                            Tipo dados de entrada
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#l3_peso" data-toggle="tab">
                                            Vincular Peso
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="col-xs-9">
                                <div class="tab-content">
                                    <div class="tab-pane active" id="l3_geral">
                                        @Html.Partial("ParL3Geral")
                                    </div>
                                    <div class="tab-pane" id="l3_avancados">
                                        @Html.Partial("ParL3Avancados")
                                    </div>
                                    <div class="tab-pane" id="l3_avam">
                                        @Html.Partial("ParL3Avam")
                                    </div>
                                    <div class="tab-pane" id="l3_tipo_dado_entrada">
                                        @Html.Partial("ParL3TipoDadoEntrada")
                                    </div>
                                    <div class="tab-pane" id="l3_peso">
                                        @Html.Partial("ParL3VincularPeso")
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>

    let objToSend = {};

    let setSelectLevel1 = function (data) {
        preencheSelect('selectL1', 'Name', 'Id', data.ParLevels1, 'Selecione o Inidicador', preencheL1);
        getSelectsL1();
    }

    let setSelectLevel2 = function (data) {
        preencheSelect('selectL2', 'Name', 'Id', data.ParLevels2, 'Selecione o Monitoramento', preencheL2);
        //getSelectsL2();
    }

    let setSelectLevel3 = function (data) {
        preencheSelect('selectL3', 'Name', 'Id', data.ParLevels3, 'Selecione o Tarefa', preencheL3);
        //getSelectsL3();
    }

    $(document).ready(function () {

        getGenericAjax('@Url.Action("Get", "api/ParLevel1Api")', 'Get', setSelectLevel1);

        getGenericAjax('@Url.Action("Get", "api/ParLevel2Api")', 'Get', setSelectLevel2);

        getGenericAjax('@Url.Action("Get", "api/ParLevel3Api")', 'Get', setSelectLevel3);

    });

    let preencheSelect = function (id, name, value, list, defaultText, callBack) {

        $(`select#${id}`).empty();
        $(`select#${id}`).append(`<option value="0">${defaultText}</option>`);

        $(list).each(function (i, o) {
            $(`select#${id}`).append(`<option value="${o[value]}">${o[name]}</option>`);
        });

        if (callBack)
            $(`select#${id}`).off('change').on('change', callBack);

        $(`select#${id}`).select2();
    }

    let preencheCampos = function (div_id, prefix, obj) {

        $(Object.keys(obj)).each(function (i, o) {

            var element = $(`#${div_id} [name="${prefix}${o}"]`);
            preencheValores(element, obj[o]);
            element = $(`#${div_id} [data-name="${prefix}${o}"]`);
            preencheValores(element, obj[o]);

        });

    }

    let apagaCampos = function (div_id) {

        $(`#${div_id} input`).val('');
        $(`#${div_id} select`).val(0);
        $(`#${div_id} select`).trigger('change');
        $(`#${div_id} textarea`).html('');
        $(`#${div_id} input[type='checkbox']`).removeAttr('checked');
        $(`#${div_id} [data-name]`).text('');

    }

    let preencheValores = function (element, value) {

        if (element.is('input')) {

            if (element.attr('type') == "checkbox") {
                element.attr('checked', value);
            } else {
                element.val(value);
            }

        } else if (element.is('select')) {

            element.val(value);
            element.trigger('change');

        } else {

            element.text(value);

        }
    }

    let preencheL1 = function (e) {

        if (parseInt($(this).val()) > 0) {

            $.ajax({
                url: `@Url.Action("Get", "api/ParLevel1Api")/${$(this).val()}`,
                type: 'Get',
                dataType: "json",
                data: {},
                contentType: "application/json",
                success: function (data) {
                    console.table(data);
                    preencheCampos('l1', '', data.Parlevel1)
                },
                error: function (request, error) {
                    alert("Request: " + JSON.stringify(request));
                }
            });

        } else {
            apagaCampos('l1');
        }
    }

    let preencheL2 = function (e) {

        if (parseInt($(this).val()) > 0) {

            $.ajax({
                url: `@Url.Action("Get", "api/ParLevel2Api")/${$(this).val()}`,
                type: 'Get',
                dataType: "json",
                data: {},
                contentType: "application/json",
                success: function (data) {
                    console.table(data);
                    preencheCampos('l2', '', data.Parlevel2)
                },
                error: function (request, error) {
                    alert("Request: " + JSON.stringify(request));
                }
            });

        } else {
            apagaCampos('l2');
        }
    }

    let preencheL3 = function (e) {

        if (parseInt($(this).val()) > 0) {

            $.ajax({
                url: `@Url.Action("Get", "api/ParLevel3Api")/${$(this).val()}`,
                type: 'Get',
                dataType: "json",
                data: {},
                contentType: "application/json",
                success: function (data) {
                    preencheCampos('l3', '', data.Parlevel3)
                },
                error: function (request, error) {
                    alert("Request: " + JSON.stringify(request));
                }
            });

        } else {
            apagaCampos('l3');
        }
    }

    let getSelectsL1 = function () {

        $.ajax({
            url: '@Url.Action("GetSelectsL1", "api/ParLevel1Api")',
            type: 'Get',
            dataType: "json",
            data: {},
            contentType: "application/json",
            success: function (data) {

                preencheSelect('selectL1Cluster', 'Name', 'Id', data.ParClusters, 'Selecione o Cluster', setObjToSend);
                preencheSelect('selectParConsolidation', 'Name', 'Id', data.ParConsolidationTypes, 'Selecione o tipo de Consolidação', setObjToSend);
                preencheSelect('selectParFrequency', 'Name', 'Id', data.ParFrequencies, 'Selecione o tipo de Frequência', setObjToSend);
                preencheSelect('selectParScoreType', 'Name', 'Id', data.ParScoreTypes, 'Selecione o tipo de Score');

            },
            error: function (request, error) {
                alert("Request: " + JSON.stringify(request));
            }
        });

    }

    let setObjToSend = function () {

        objToSend[$(this).prop('id')] = $(this).val();

    }

    let getGenericAjax = function (url, type, callback) {

        $.ajax({
            url: url,
            type: type,
            dataType: "json",
            data: {},
            contentType: "application/json",
            success: callback,
            error: function (request, error) {
                alert("Request: " + JSON.stringify(request));
            }
        });
    }

    let save = function (saveLevel) {

        var saveUrl = "";
        var formdata = {};

        switch (saveLevel) {

            case 1:

                formdata = $('#ParL1Geral').serializeArray().concat($('#ParL1Avancados').serializeArray());
                saveUrl = '@Url.Action("PostParLevel1", "api/ParLevel1Api")';

                break;

            case 2:
                break;
            case 3:
                break;
            case 4:
                break;
            case 5:
                break;

            default:
        }

        let data = {};

        $(formdata).each(function (index, obj) {
            data[obj.name] = obj.value;
        });

        //fazer metodo para chamar o ajax para salvar
        $.ajax({
            url: saveUrl,
            type: 'POST',
            dataType: "json",
            data: JSON.stringify(data),
            contentType: "application/json",
            success: function (data) {
                openMessageModal("Feito", "Dados Salvos");
            },
            error: function (request, error) {
                alert("Request: " + JSON.stringify(request));
            }
        });
    }

</script>
