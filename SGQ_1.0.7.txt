
Insert into MigrationHistory (Name, AddDate) VALUES ('20180927_1600_AdicionarParCluster_Id_na_PARLEVEL1XMODULE',GetDate())

GO

IF NOT EXISTS 
	(
		SELECT * FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE 
		WHERE 1=1
		 AND TABLE_NAME = 'ParGroupParLevel1'
		 AND COLUMN_NAME = 'Id'
	) 
  BEGIN
	ALTER TABLE ParGroupParLevel1
	ADD PRIMARY KEY (Id)
  END 

GO

IF COL_LENGTH('PARLEVEL1XMODULE','ParCluster_Id') IS NULL
    BEGIN
		ALTER TABLE PARLEVEL1XMODULE
		ADD ParCluster_Id Int null;
		
		ALTER TABLE [dbo].[ParLevel1XModule]  WITH CHECK ADD  CONSTRAINT [FK_ParLevel1XModule_ParCluster] FOREIGN KEY([ParCluster_Id])
		REFERENCES [dbo].[ParCluster] ([Id])
    END

GO

Insert into MigrationHistory (Name, AddDate) VALUES ('SGQ_1.0.7_InsercaoParVinculoPeso',GetDate());

GO


IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='ParVinculoPeso' AND xtype='U')
create table ParVinculoPeso(
	Id int not null identity primary key,
	Name varchar(max) NOT NULL,
	AddDate datetime not null,
	AlterDate datetime,	
	IsActive bit not null,
	Peso int not null,
	ParCompany_Id int not null FOREIGN key REFERENCES ParCompany(Id),
	ParDepartment_Id int not null FOREIGN key REFERENCES ParDepartment(Id),
	ParLevel2_Id int not null FOREIGN key REFERENCES ParLevel2(Id),
	ParGroupParLevel1_Id int NOT NULL FOREIGN key REFERENCES ParGroupParLevel1(Id),
	ParLevel1_Id int not null FOREIGN key REFERENCES ParLevel1(Id),
	ParLevel3_Id int not null FOREIGN key REFERENCES ParLevel3(Id),	
)

GO



Insert into MigrationHistory (Name, AddDate) VALUES ('SGQ_1.0.7_InsercaoDeTabelaDeLogDeBanco',GetDate());

GO


IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='DatabaseLog' AND xtype='U')
create table DatabaseLog(
	Id bigint not null identity primary key,
	Tabela varchar(200) NOT NULL,
	Json varchar(max) NOT NULL,
	Operacao int NOT NULL,
	AddDate datetime not null
)

GO



Insert into MigrationHistory (Name, AddDate) VALUES ('SGQ_1.0.7_InsercaoDeTabelaDeLogDeErro',GetDate());

GO


IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='ErrorLog' AND xtype='U')
create table ErrorLog(
	Id bigint not null identity primary key,
	StackTrace varchar(max) NOT NULL,
	AddDate datetime not null
)

GO
 
IF COL_LENGTH('ParGroupParLevel1','Parent_Id') IS NULL
    BEGIN
		ALTER TABLE ParGroupParLevel1
		ADD Parent_Id int;
    END

go
 
IF COL_LENGTH('ParGroupParLevel1','Hash') IS NULL
    BEGIN
		ALTER TABLE ParGroupParLevel1
		ADD Hash varchar(900);
    END

GO

Insert into MigrationHistory (Name, AddDate) VALUES ('SGQ_1.0.7_InsercaoDepartamentoCentroCusto',GetDate());

GO
 
IF COL_LENGTH('ParDepartment','Parent_Id') IS NULL
    BEGIN
		ALTER TABLE ParDepartment
		ADD Parent_Id int;
    END

go
 
IF COL_LENGTH('ParDepartment','Hash') IS NULL
    BEGIN
		ALTER TABLE ParDepartment
		ADD Hash varchar(900);
    END

GO

Insert into MigrationHistory (Name, AddDate) VALUES ('SGQ_1.0.7_VolumePorTurno',GetDate());

GO

IF COL_LENGTH('VolumePCC1b','Shift_Id') IS NULL
    BEGIN
		ALTER TABLE VolumePCC1b 
		ADD Shift_Id int null
    END

GO

IF COL_LENGTH('VolumeCEPDesossa','Shift_Id') IS NULL
    BEGIN
		ALTER TABLE VolumeCEPDesossa 
		ADD Shift_Id int null
    END

GO

IF COL_LENGTH('VolumeVacuoGRD','Shift_Id') IS NULL
    BEGIN
		ALTER TABLE VolumeVacuoGRD 
		ADD Shift_Id int null
    END

GO

IF COL_LENGTH('VolumeCepRecortes','Shift_Id') IS NULL
    BEGIN
		ALTER TABLE VolumeCepRecortes 
		ADD Shift_Id int null
    END
GO

Insert into MigrationHistory (Name, AddDate) VALUES ('PA_DiretrizesPriorizadas',GetDate());

GO

IF COL_LENGTH('Pa_Objetivo','IsPriority') IS NULL
    BEGIN
		ALTER TABLE Pa_Objetivo
		ADD IsPriority bit not null default 0;
    END
GO

IF COL_LENGTH('ReportXUserSgq','NomeRelatorio') IS NULL
    BEGIN
		ALTER TABLE ReportXUserSgq
		ADD NomeRelatorio varchar(100);
    END

GO