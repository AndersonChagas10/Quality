

IF COL_LENGTH('ParCompany','Identification') IS NULL
    BEGIN	
		ALTER TABLE ParCompany ADD Identification varchar(50) null;
    END
GO


IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='ParLevelHeaderField' AND xtype='U')
create table ParLevelHeaderField (
	Id int primary key not null identity,
	Name varchar(100) not null,
	TableName varchar(100) not null,
	AddDate datetime2 not null,
	AlterDate datetime2, 
	IsActive bit not null default 1
)

go

IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='ParHeaderFieldGeral' AND xtype='U')
create table ParHeaderFieldGeral (
	Id int not null primary key identity,
	Name varchar(100) not null,
	ParFieldType_Id int not null,
	Description varchar(100),
	ParLevelHeaderField_Id int not null,
	Generic_Id int not null,
	LinkNumberEvaluation bit not null default 0,
	IsActive bit not null default 1,
	IsRequired bit not null default 0,
	Duplicate bit not null default 0,
	AddDate datetime2 not null,
	AlterDate datetime2,
	Foreign key (ParFieldType_Id) references ParFieldType(Id),
	Foreign key (ParLevelHeaderField_Id) references ParLevelHeaderField(Id)
)
go

IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='ParMultipleValuesGeral' AND xtype='U')
create table ParMultipleValuesGeral (
	Id int not null primary key identity,
	ParHeaderFieldGeral_Id Int foreign key references ParHeaderFieldGeral(Id) not null,
	Name varchar(100) not null,
	Description varchar(255),
	PunishmentValue decimal(38,10),
	Conformity bit not null,
	AddDate datetime2 not null,
	AlterDate datetime2,
	IsActive bit not null default 1,
	IsDefaultOption bit not null default 0
)
go

BEGIN
   IF NOT EXISTS (Select * from ParLevelHeaderField where id = 1)
   BEGIN
		INSERT into ParLevelHeaderField (Name, TableName, AddDate) VALUES ('Indicador', 'ParLevel1', GETDATE())
   END
END
GO

BEGIN
   IF NOT EXISTS (Select * from ParLevelHeaderField where id = 2)
   BEGIN
		INSERT into ParLevelHeaderField (Name, TableName, AddDate) VALUES ('Monitoramento', 'ParLevel2', GETDATE())
   END
END
GO

BEGIN
   IF NOT EXISTS (Select * from ParLevelHeaderField where id = 3)
   BEGIN
		INSERT into ParLevelHeaderField (Name, TableName, AddDate) VALUES ('Centro de Custo / Seção', 'ParDeparment',  GETDATE())
   END
END
GO

BEGIN
   IF NOT EXISTS (Select * from ParLevel3InputType where Id = 13)
   BEGIN
		INSERT into ParLevel3InputType (Id,Name, Description, AddDate, IsActive) VALUES (13,'Data', 'Data',  GETDATE(), 1)
   END
END

GO

BEGIN
   IF NOT EXISTS (Select * from ParLevel3InputType where Id = 14)
   BEGIN
		INSERT into ParLevel3InputType (Id,Name, Description, AddDate, IsActive) VALUES (14,'Hora', 'Hora',  GETDATE(), 1)
   END
END

GO

IF COL_LENGTH('ParLevel3Value','ShowLevel3Limits') IS NULL
    BEGIN	
		ALTER table ParLevel3Value add ShowLevel3Limits bit not null default 1
    END
GO

SET IDENTITY_INSERT ParFrequency ON;
GO
BEGIN
   IF NOT EXISTS (Select * from ParFrequency where Id = 12)
   BEGIN
		INSERT into ParFrequency (Id,Name,Description,AddDate,AlterDate,IsActive) VALUES (12,'Bimestral','Bimestral', getdate(), NULL, 1);
   END
END 
GO
BEGIN
   IF NOT EXISTS (Select * from ParFrequency where Id = 13)
   BEGIN
		INSERT into ParFrequency (Id,Name,Description,AddDate,AlterDate,IsActive) VALUES (13,'Trimestral','Trimestral', getdate(),	NULL, 1);
   END
END 
GO
BEGIN
   IF NOT EXISTS (Select * from ParFrequency where Id = 14)
   BEGIN
		INSERT into ParFrequency (Id,Name,Description,AddDate,AlterDate,IsActive) VALUES (14,'Semestral','Semestral', getdate(),	NULL, 1);
   END
END 
GO
BEGIN
   IF NOT EXISTS (Select * from ParFrequency where Id = 15)
   BEGIN
		INSERT into ParFrequency (Id,Name,Description,AddDate,AlterDate,IsActive) VALUES (15,'Anual','Anual', getdate(),	NULL, 1);
   END
END 
GO
SET IDENTITY_INSERT ParFrequency OFF
GO

IF COL_LENGTH('ParVinculoPeso','ParGroupParlevel1_id') IS NULL
    BEGIN	
		ALTER TABLE ParVinculoPeso ADD ParGroupParlevel1_id int null;
    END

GO

IF COL_LENGTH('ParVinculoPeso','EffectiveDateStart') IS NOT NULL
    BEGIN	
		ALTER TABLE ParVinculoPeso
		DROP COLUMN EffectiveDateStart
    END

GO

IF COL_LENGTH('ParVinculoPeso','EffectiveDateEnd') IS NOT NULL
    BEGIN	
		ALTER TABLE ParVinculoPeso
		DROP COLUMN EffectiveDateEnd
    END

GO

IF COL_LENGTH('ParVinculoPeso','ParGroupParlevel1_id') IS NOT NULL
BEGIN
	ALTER TABLE ParVinculoPeso ALTER COLUMN ParGroupParlevel1_id int NULL
END

--Scripts de CRUD dinâmico

 IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='ComponenteGenerico' AND xtype='U')
CREATE TABLE ComponenteGenerico (
	Id int not null primary key identity,
	AddDate Datetime2 not null,
	AlterDate Datetime2,
	Name varchar(255) not null,
	IsActive bit not null default 1
) 

GO

 IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='ComponenteGenericoTipoColuna' AND xtype='U')
CREATE TABLE ComponenteGenericoTipoColuna (
	Id int not null primary key identity,
	AddDate Datetime2 not null,
	AlterDate Datetime2,
	Name varchar(255) not null,
	IsActive bit not null default 1
)

go

if not exists(select Id from ComponenteGenericoTipoColuna where id = 1)
INSERT INTO ComponenteGenericoTipoColuna(AddDate, Name) VALUES (getdate(), 'text');
if not exists(select Id from ComponenteGenericoTipoColuna where id = 2)
INSERT INTO ComponenteGenericoTipoColuna(AddDate, Name) VALUES (getdate(), 'number');
if not exists(select Id from ComponenteGenericoTipoColuna where id = 3)
INSERT INTO ComponenteGenericoTipoColuna(AddDate, Name) VALUES (getdate(), 'checkbox');
if not exists(select Id from ComponenteGenericoTipoColuna where id = 4)
INSERT INTO ComponenteGenericoTipoColuna(AddDate, Name) VALUES (getdate(), 'textarea');
if not exists(select Id from ComponenteGenericoTipoColuna where id = 5)
INSERT INTO ComponenteGenericoTipoColuna(AddDate, Name) VALUES (getdate(), 'select');
if not exists(select Id from ComponenteGenericoTipoColuna where id = 6)
INSERT INTO ComponenteGenericoTipoColuna(AddDate, Name) VALUES (getdate(), 'date');
if not exists(select Id from ComponenteGenericoTipoColuna where id = 7)
INSERT INTO ComponenteGenericoTipoColuna(AddDate, Name) VALUES (getdate(), 'hour');
if not exists(select Id from ComponenteGenericoTipoColuna where id = 8)
insert into ComponenteGenericoTipoColuna(AddDate, Name) VALUES (getdate(), 'limite');

GO

IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='ComponenteGenericoColuna' AND xtype='U')
CREATE TABLE ComponenteGenericoColuna (
	Id int not null primary key identity,
	AddDate Datetime2 not null,
	AlterDate Datetime2,
	Name varchar(255) not null,
	ComponenteGenerico_Id int not null foreign key references ComponenteGenerico(Id),
	ComponenteGenericoTipoColuna_Id int not null foreign key references ComponenteGenericoTipoColuna(Id),
	IsRequired bit not null default 0,
	ValorPadrao varchar(255),
	IsActive bit not null default 1
)

GO

IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='ComponenteGenericoValor' AND xtype='U')
CREATE TABLE ComponenteGenericoValor(
	Id int not null primary key identity,
	SaveId int not null, 
	AddDate Datetime2 not null,
	AlterDate Datetime2,
	ComponenteGenerico_Id int not null foreign key references ComponenteGenerico(Id),
	ComponenteGenericoColuna_Id int not null foreign key references ComponenteGenericoColuna(Id),
	Valor varchar(255),
	IsActive bit not null default 1
)

GO
GO

IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='CollectionLevel2XParHeaderFieldGeral' AND xtype='U')
CREATE TABLE CollectionLevel2XParHeaderFieldGeral  (
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[CollectionLevel2_Id] [int] NOT NULL,
	[ParHeaderFieldGeral_Id] [int] NOT NULL,
	[ParHeaderField_Name] [nvarchar](max) NOT NULL,
	[ParFieldType_Id] [int] NOT NULL,
	[Value] [nvarchar](max) NOT NULL,
	[Evaluation] [int] NULL,
	[Sample] [int] NULL,
	FOREIGN KEY ([CollectionLevel2_Id]) REFERENCES CollectionLevel2(Id),
	FOREIGN KEY ([ParFieldType_Id]) REFERENCES ParFieldType(Id),
	FOREIGN KEY ([ParHeaderFieldGeral_Id]) REFERENCES ParHeaderFieldGeral(Id),
    PRIMARY KEY (Id)
);

GO

IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='ParHeaderFieldXComponenteGenerico' AND xtype='U')
create table ParHeaderFieldXComponenteGenerico (
	Id int primary key not null identity,
	AddDate datetime2 not null,
	AlterDate datetime2,
	ComponenteGenerico_Id int foreign key references ComponenteGenerico(Id),
	ParHeaderField_Id int foreign key references ParHeaderField(Id),
	Value varchar(255) not null,
	Text varchar(255) not null
)

IF NOT EXISTS (SELECT * FROM ParFieldType WHERE Id = 11)
	INSERT INTO ParFieldType VALUES (11, 'Componente', 'Componente Genérico', GETDATE(), NULL, 1)
GO